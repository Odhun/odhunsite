<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Odhun Son Dakika | Halkın Habercisi</title>

<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect width=%22100%22 height=%22100%22 rx=%2220%22 fill=%22%23dc2626%22/><text x=%2250%25%22 y=%2255%25%22 dominant-baseline=%22middle%22 text-anchor=%22middle%22 font-family=%22Arial%22 font-weight=%22900%22 font-size=%22240%22 fill=%22%23ffffff%22>SD</text></svg>">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;500;700;900&display=swap" rel="stylesheet">

<style>
    :root {
        --bg: #0f172a;
        --card-bg: #1e293b;
        --primary: #dc2626;
        --text: #f8fafc;
        --text-dim: #94a3b8;
        --green: #22c55e;
        --red: #ef4444;
        --orange: #f97316;
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

    body {
        margin: 0; padding: 0; background-color: var(--bg); color: var(--text);
        font-family: 'Inter', sans-serif; padding-bottom: 50px;
    }

    /* HEADER */
    header {
        background: rgba(30, 41, 59, 0.95); padding: 15px 20px; 
        position: sticky; top: 0; z-index: 100; backdrop-filter: blur(10px);
        border-bottom: 1px solid rgba(255,255,255,0.1);
        display: flex; justify-content: space-between; align-items: center;
    }
    .brand { font-size: 1.5rem; font-weight: 900; color: #fff; letter-spacing: -1px; }
    .brand span { color: var(--primary); margin-left: 5px; }
    
    .header-actions { display: flex; gap: 10px; }
    
    .btn-header {
        border: none; padding: 8px 15px; border-radius: 20px; font-weight: 700; 
        cursor: pointer; display: flex; align-items: center; gap: 5px; font-size: 0.9rem;
    }
    .new-post-btn { background: var(--primary); color: #fff; }
    .contact-btn { background: #334155; color: #fff; }

    /* 3. BİLGİLENDİRME METNİ (YENİ) */
    .info-box {
        max-width: 600px; margin: 20px auto 0; padding: 15px;
        background: rgba(30, 41, 59, 0.5); border-radius: 8px; border-left: 4px solid var(--primary);
        font-size: 0.9rem; color: #cbd5e1; line-height: 1.5;
    }
    .info-title { color: #fff; font-weight: 700; margin-bottom: 5px; display: block; }

    /* MODALLAR */
    .modal-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.8); z-index: 200; display: none;
        align-items: center; justify-content: center; padding: 20px;
    }
    .modal-content {
        background: var(--card-bg); width: 100%; max-width: 500px; border-radius: 15px;
        padding: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.5); border: 1px solid rgba(255,255,255,0.1);
    }
    .modal-header { display: flex; justify-content: space-between; margin-bottom: 15px; font-weight: 700; font-size: 1.2rem; }
    .close-btn { background: none; border: none; color: #fff; font-size: 1.5rem; cursor: pointer; }
    
    input, textarea {
        width: 100%; background: #0f172a; border: 1px solid #334155; color: #fff;
        padding: 12px; border-radius: 8px; margin-bottom: 10px; font-family: inherit; outline: none;
    }
    textarea { height: 100px; resize: none; }
    
    .file-label {
        display: block; background: #334155; padding: 10px; border-radius: 8px; text-align: center;
        cursor: pointer; margin-bottom: 15px; color: #ccc; border: 2px dashed #475569;
    }
    
    .submit-btn {
        width: 100%; background: var(--primary); color: #fff; padding: 12px; border: none;
        border-radius: 8px; font-weight: 800; font-size: 1rem; cursor: pointer;
    }
    .submit-btn:disabled { opacity: 0.5; cursor: not-allowed; }

    /* FEED */
    .feed-container { max-width: 600px; margin: 20px auto; padding: 0 15px; min-height: 400px; }
    
    .news-card {
        background: var(--card-bg); border-radius: 12px; overflow: hidden; margin-bottom: 20px;
        border: 1px solid rgba(255,255,255,0.05); animation: slideUp 0.3s ease;
    }
    @keyframes slideUp { from { opacity:0; transform:translateY(20px); } to { opacity:1; transform:translateY(0); } }

    .card-header {
        padding: 15px; display: flex; align-items: center; gap: 10px; border-bottom: 1px solid rgba(255,255,255,0.05);
    }
    .avatar {
        width: 40px; height: 40px; background: linear-gradient(45deg, #475569, #1e293b);
        border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700;
    }
    .user-info h4 { margin: 0; font-size: 0.95rem; color: #fff; }
    .user-info span { font-size: 0.75rem; color: var(--text-dim); }

    .card-body { padding: 15px; }
    .news-text { font-size: 0.95rem; line-height: 1.5; color: #e2e8f0; white-space: pre-wrap; }
    
    /* 2. GÖRSEL DÜZELTMESİ (TAM GÖRÜNÜM) */
    .news-img { 
        width: 100%; 
        border-radius: 8px; 
        margin-top: 10px; 
        display: block; 
        max-height: none; /* Sınırı kaldırdık */
        object-fit: contain; /* Resmi bozmadan sığdır */
        background: #000;
    }

    .card-footer {
        padding: 10px 15px; background: rgba(0,0,0,0.2); display: flex; justify-content: space-between; align-items: center;
    }
    .vote-area { display: flex; align-items: center; gap: 15px; }
    .vote-btn {
        background: none; border: none; color: var(--text-dim); cursor: pointer; font-size: 1rem;
        display: flex; align-items: center; gap: 5px; transition: 0.2s;
    }
    .vote-btn:hover { transform: scale(1.1); }
    
    /* Oylanmışsa renkli kalır */
    .vote-btn.voted-up { color: var(--green); }
    .vote-btn.voted-down { color: var(--red); }
    
    .remove-btn {
        color: #64748b; font-size: 0.8rem; background: none; border: 1px solid rgba(255,255,255,0.1);
        padding: 5px 10px; border-radius: 5px; cursor: pointer; transition: 0.2s;
    }
    .remove-btn:hover { color: var(--orange); border-color: var(--orange); }

    /* 4. YASAL UYARI BANNERI */
    .legal-banner {
        background: #020617; color: #64748b; padding: 30px 20px; text-align: center; font-size: 0.8rem;
        border-top: 1px solid rgba(255,255,255,0.05); margin-top: 50px; line-height: 1.6;
    }
    .legal-banner strong { color: #fff; }

    .loader { text-align: center; padding: 20px; color: var(--text-dim); font-style: italic; }
    #previewImg { width: 100%; max-height: 200px; object-fit: cover; border-radius: 8px; display: none; margin-bottom: 10px; }
    
    .copy-box {
        background: #0f172a; padding: 10px; border-radius: 8px; border: 1px dashed #334155;
        text-align: center; cursor: pointer; font-family: monospace; margin-bottom: 15px;
    }
    .copy-box:hover { border-color: var(--primary); color: #fff; }
</style>
</head>
<body>

    <header>
        <div class="brand">ODHUN <span>SONDAKİKA</span></div>
        <div class="header-actions">
            <button class="btn-header contact-btn" onclick="openContactModal()"><i class="fas fa-envelope"></i> İletişim</button>
            <button class="btn-header new-post-btn" onclick="openPostModal()"><i class="fas fa-plus"></i> Haber Gir</button>
        </div>
    </header>

    <div class="info-box">
        <span class="info-title"><i class="fas fa-info-circle"></i> Odhun Son Dakika Nedir?</span>
        Bu platform, vatandaş gazeteciliğini desteklemek amacıyla <strong>Odhun.com</strong> tarafından geliştirilmiştir. 
        Çevrenizde gördüğünüz olayları, kazaları veya önemli gelişmeleri anlık olarak paylaşabilirsiniz. 
        Paylaşımlar tamamen anonimdir. Doğruluğu şüpheli veya uygunsuz haberleri topluluk olarak oylayarak yayından kaldırabilirsiniz.
    </div>

    <div class="feed-container" id="feed">
        <div class="loader" id="loader">Haberler yükleniyor...</div>
    </div>

    <div class="legal-banner">
        <p><strong>Odhun.com © 2025</strong> - Odhun tarafından tasarlanmıştır.</p>
        <p>Bu sitede yer alan tüm içerikler kullanıcılar tarafından oluşturulmaktadır ve <strong>Odhun.com</strong>'un resmi görüşlerini yansıtmaz. 
        Platform yer sağlayıcı konumundadır. Paylaşılan içeriklerin hukuki ve cezai sorumluluğu tamamen paylaşımı yapan kullanıcıya aittir. 
        Telif hakkı ihlali, kişilik haklarına saldırı veya yasa dışı içerik barındıran paylaşımlar, <strong>odhunticaret@gmail.com</strong> adresine 
        yapılan bildirimler üzerine veya topluluk oylaması ile derhal yayından kaldırılacaktır.</p>
    </div>

    <div id="postModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header"><span>Haber Paylaş</span><button class="close-btn" onclick="closePostModal()">&times;</button></div>
            <div id="timerMsg" style="color:var(--orange); font-size:0.9rem; margin-bottom:10px; display:none;"></div>
            <input type="text" id="nickInput" placeholder="Rumuzunuz (Örn: Vatandaş)" maxlength="20">
            <textarea id="textInput" placeholder="Ne oldu? Gördüklerini anlat..."></textarea>
            <img id="previewImg">
            <label class="file-label" for="fileInput"><i class="fas fa-camera"></i> Fotoğraf Ekle</label>
            <input type="file" id="fileInput" accept="image/*" style="display:none" onchange="handleFile(this)">
            <button class="submit-btn" id="sendBtn" onclick="sendPost()">PAYLAŞ</button>
        </div>
    </div>

    <div id="contactModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header"><span>İletişime Geç</span><button class="close-btn" onclick="closeContactModal()">&times;</button></div>
            <div class="copy-box" onclick="copyMail()" title="Tıkla Kopyala">odhunticaret@gmail.com</div>
            <input type="text" id="contactSubject" placeholder="Konu">
            <textarea id="contactMessage" placeholder="Mesajınız..."></textarea>
            <button class="submit-btn" onclick="sendMail()">GÖNDER</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, updateDoc, doc, increment, serverTimestamp, deleteDoc, getDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyB3Cmv9J8x9b53HPzgVmOIEF-_fKhwejPo",
            authDomain: "anit-805a2.firebaseapp.com",
            projectId: "anit-805a2",
            storageBucket: "anit-805a2.firebasestorage.app",
            messagingSenderId: "840387116828",
            appId: "1:840387116828:web:02af9068f7bcdf2135c4d9",
            measurementId: "G-QP5EPSFT8V"
        };

        let db;
        try { const app = initializeApp(firebaseConfig); db = getFirestore(app); loadPosts(); } catch (e) {}

        // KÖTÜ KELİME FİLTRESİ
        const blackList = ["küfür", "hakaret", "aptal", "gerizekalı", "salak", "mal", "şerefsiz", "porno", "seks", "kumar", "bahis", "+18", "xxx", "amk", "aq", "piç", "yarrak", "orospu", "siktir", "göt", "meme", "kaşar", "yavşak", "sik", "ananı", "bacını", "sokayım", "sokarım"];

        function checkContent(text) {
            const lower = text.toLowerCase();
            for(let word of blackList) {
                if(lower.includes(word)) return false;
            }
            return true;
        }

        window.sendPost = async () => {
            const lastPostTime = parseInt(localStorage.getItem('lastPostTime') || 0);
            const spamCount = parseInt(localStorage.getItem('spamCount') || 0);
            const waitTime = 5 * (spamCount + 1) * 60 * 1000;
            const now = Date.now();

            if (now - lastPostTime < waitTime) {
                const remaining = Math.ceil((waitTime - (now - lastPostTime)) / 60000);
                document.getElementById('timerMsg').style.display = 'block';
                document.getElementById('timerMsg').innerText = `Çok sık paylaşım yapıyorsunuz. ${remaining} dakika beklemelisiniz.`;
                return;
            }

            const nick = document.getElementById('nickInput').value.trim();
            const text = document.getElementById('textInput').value.trim();
            const img = document.getElementById('previewImg').src;
            const btn = document.getElementById('sendBtn');

            if (!nick || !text) { alert("Lütfen alanları doldurun."); return; }
            
            if (!checkContent(text) || !checkContent(nick)) {
                alert("İçeriğinizde uygunsuz ifadeler tespit edildi.");
                return;
            }

            btn.disabled = true;
            btn.innerText = "Paylaşılıyor...";

            try {
                await addDoc(collection(db, "posts"), {
                    nick: nick, text: text, image: img !== "" && img !== window.location.href ? img : null, 
                    likes: 0, dislikes: 0, removeVotes: 0, timestamp: serverTimestamp()
                });
                
                localStorage.setItem('lastPostTime', now);
                localStorage.setItem('spamCount', spamCount + 1);

                closePostModal();
                document.getElementById('textInput').value = "";
                document.getElementById('previewImg').style.display = 'none';
                document.getElementById('previewImg').src = "";
                document.getElementById('timerMsg').style.display = 'none';
            } catch (e) { alert("Hata oluştu."); }
            btn.disabled = false; btn.innerText = "PAYLAŞ";
        };

        function loadPosts() {
            const q = query(collection(db, "posts"), orderBy("timestamp", "desc"));
            onSnapshot(q, (snapshot) => {
                const feed = document.getElementById('feed');
                feed.innerHTML = ""; 
                if(snapshot.empty) { feed.innerHTML = "<div class='loader'>Henüz haber yok. İlk sen paylaş!</div>"; return; }

                snapshot.forEach((docData) => {
                    const post = docData.data();
                    const id = docData.id;
                    const time = post.timestamp ? new Date(post.timestamp.toDate()).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}) : "Şimdi";
                    
                    const voteState = localStorage.getItem(`vote_${id}`); // 'up' veya 'down'
                    const removeState = localStorage.getItem(`remove_${id}`);
                    
                    const interactionTotal = (post.likes || 0) + (post.dislikes || 0);
                    const removalThreshold = Math.max(1, interactionTotal); 
                    const currentRemoves = post.removeVotes || 0;
                    
                    let imgHtml = post.image && post.image.length > 100 ? `<img src="${post.image}" class="news-img">` : "";

                    const html = `
                    <div class="news-card">
                        <div class="card-header"><div class="avatar">${post.nick.charAt(0).toUpperCase()}</div>
                        <div class="user-info"><h4>${post.nick}</h4><span>${time}</span></div></div>
                        <div class="card-body"><div class="news-text">${formatText(post.text)}</div>${imgHtml}</div>
                        <div class="card-footer">
                            <div class="vote-area">
                                <button class="vote-btn ${voteState==='up' ? 'voted-up' : ''}" onclick="vote('${id}','up')"><i class="fas fa-arrow-up"></i> <span>${post.likes||0}</span></button>
                                <button class="vote-btn ${voteState==='down' ? 'voted-down' : ''}" onclick="vote('${id}','down')"><i class="fas fa-arrow-down"></i> <span>${post.dislikes||0}</span></button>
                            </div>
                            <button class="remove-btn ${removeState?'voted':''}" onclick="voteRemove('${id}')"><i class="fas fa-trash"></i> Kaldır (${currentRemoves}/${removalThreshold})</button>
                        </div>
                    </div>`;
                    feed.innerHTML += html;
                });
            });
        }

        // 1. TEK SEFERLİK OYLAMA
        window.vote = async (id, type) => {
            // Daha önce oy verip vermediğini kontrol et
            if (localStorage.getItem(`vote_${id}`)) { 
                alert("Bu haberi zaten oyladınız!"); 
                return; 
            }

            const postRef = doc(db, "posts", id);
            await updateDoc(postRef, type === 'up' ? { likes: increment(1) } : { dislikes: increment(1) });
            
            // Oyu kaydet ki tekrar basamasın
            localStorage.setItem(`vote_${id}`, type);
        };

        window.voteRemove = async (id) => {
            if (localStorage.getItem(`remove_${id}`)) { alert("Zaten oy kullandınız."); return; }
            if(!confirm("Bu haberi kaldırmak istediğinize emin misiniz?")) return;
            
            const postRef = doc(db, "posts", id);
            await updateDoc(postRef, { removeVotes: increment(1) });
            localStorage.setItem(`remove_${id}`, 'true');
            
            const snap = await getDoc(postRef);
            if (snap.exists()) {
                const data = snap.data();
                if ((data.removeVotes || 0) >= Math.max(1, (data.likes||0)+(data.dislikes||0))) {
                    await deleteDoc(postRef);
                    alert("Haber kaldırıldı.");
                }
            }
        };

        function formatText(text) { return text.replace(/(https?:\/\/[^\s]+)/g, '<a href="$1" target="_blank" style="color:#3b82f6">$1</a>'); }
        window.handleFile = (input) => { const file = input.files[0]; if (file) { const r = new FileReader(); r.onload = (e) => { const i = document.getElementById('previewImg'); i.src = e.target.result; i.style.display = 'block'; }; r.readAsDataURL(file); } }
        window.openPostModal = () => document.getElementById('postModal').style.display = 'flex';
        window.closePostModal = () => document.getElementById('postModal').style.display = 'none';
        window.openContactModal = () => document.getElementById('contactModal').style.display = 'flex';
        window.closeContactModal = () => document.getElementById('contactModal').style.display = 'none';
        window.sendMail = () => { window.location.href = `mailto:odhunticaret@gmail.com?subject=${encodeURIComponent(document.getElementById('contactSubject').value)}&body=${encodeURIComponent(document.getElementById('contactMessage').value)}`; closeContactModal(); };
        window.copyMail = () => { navigator.clipboard.writeText("odhunticaret@gmail.com"); alert("Mail adresi kopyalandı!"); };
    </script>

</body>
</html>
