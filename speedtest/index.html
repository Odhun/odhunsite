<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Odhun Speed | Hız Testi</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect width=%22100%22 height=%22100%22 rx=%2220%22 fill=%22%23000000%22/><text x=%2250%25%22 y=%2255%25%22 dominant-baseline=%22middle%22 text-anchor=%22middle%22 font-family=%22Arial%22 font-weight=%22900%22 font-size=%2240%22 fill=%22%23ffffff%22>O<tspan fill=%22%2300e5ff%22>S</tspan></text></svg>">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=Orbitron:wght@500;700;900&display=swap" rel="stylesheet">

<style>
    :root {
        --bg: #050505;
        --panel: #111;
        --accent: #00e5ff; /* Speed Cyan */
        --border: #222;
        --text: #fff;
        --text-dim: #666;
        --sidebar-width: 260px;
    }

    * { box-sizing: border-box; }

    body {
        margin: 0; padding: 0; background: var(--bg); color: var(--text);
        font-family: 'Inter', sans-serif; height: 100vh; display: flex; overflow: hidden;
    }

    /* --- SIDEBAR --- */
    .sidebar {
        width: var(--sidebar-width); background: var(--panel); 
        border-right: 1px solid var(--border); display: flex; flex-direction: column;
        flex-shrink: 0; z-index: 100; transition: transform 0.3s ease;
    }

    .logo-area {
        height: 70px; display: flex; align-items: center; padding: 0 25px;
        font-size: 1.5rem; font-weight: 900; letter-spacing: -1px;
        border-bottom: 1px solid var(--border);
    }
    .logo-area span { color: var(--accent); margin-left: 2px; }

    .menu-list { padding: 20px; }
    .menu-item {
        display: flex; align-items: center; gap: 10px; padding: 12px 15px;
        color: var(--text-dim); text-decoration: none; font-weight: 600;
        border-radius: 8px; margin-bottom: 5px; transition: 0.2s; cursor: default;
    }
    .menu-item.active { background: rgba(0, 229, 255, 0.1); color: var(--accent); border-left: 3px solid var(--accent); }

    /* --- MAIN CONTENT --- */
    .main-content {
        flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center;
        position: relative; background: radial-gradient(circle at center, #1a2224 0%, #000000 100%);
    }

    /* GAUGE (HIZ GÖSTERGESİ) */
    .gauge-wrapper {
        position: relative; width: 300px; height: 150px; margin-bottom: 40px;
    }
    
    /* Yarım Daire Arka Plan */
    .gauge-bg {
        width: 300px; height: 150px; border-radius: 150px 150px 0 0;
        background: #1a1a1a; border: 2px solid #333; border-bottom: none;
        position: relative; overflow: hidden;
    }
    
    /* Renkli Dolum Barı */
    .gauge-fill {
        position: absolute; top: 100%; left: 0; width: 100%; height: 100%;
        background: var(--accent); transform-origin: center top;
        transform: rotate(0deg); transition: transform 0.2s ease-out;
        opacity: 0.2;
    }

    /* İbre */
    .needle {
        width: 4px; height: 140px; background: #fff;
        position: absolute; bottom: 0; left: 50%; margin-left: -2px;
        transform-origin: bottom center; transform: rotate(-90deg);
        transition: transform 0.5s cubic-bezier(0.4, 2.08, 0.55, 0.44);
        z-index: 10; border-radius: 4px;
        box-shadow: 0 0 10px var(--accent);
    }
    .needle::after {
        content: ''; position: absolute; bottom: -10px; left: -10px;
        width: 24px; height: 24px; background: #fff; border-radius: 50%;
    }

    /* Hız Metni */
    .speed-text-container {
        position: absolute; bottom: -60px; left: 50%; transform: translateX(-50%);
        text-align: center;
    }
    .speed-value {
        font-family: 'Orbitron', sans-serif; font-size: 4rem; font-weight: 900;
        color: var(--text); text-shadow: 0 0 20px var(--accent);
    }
    .speed-unit { font-size: 1rem; color: var(--text-dim); font-weight: 600; letter-spacing: 1px; }

    /* İSTATİSTİKLER */
    .stats-grid {
        display: flex; gap: 40px; margin-top: 80px; margin-bottom: 50px;
    }
    .stat-box { text-align: center; }
    .stat-label { font-size: 0.8rem; color: var(--text-dim); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px; }
    .stat-val { font-family: 'Orbitron', sans-serif; font-size: 1.5rem; font-weight: 700; color: #fff; }
    
    /* BUTON */
    .start-btn {
        padding: 15px 50px; border-radius: 50px; border: 2px solid var(--accent);
        background: transparent; color: var(--accent); font-size: 1.2rem; font-weight: 800;
        cursor: pointer; transition: 0.3s; text-transform: uppercase; letter-spacing: 2px;
        box-shadow: 0 0 15px rgba(0, 229, 255, 0.1);
    }
    .start-btn:hover {
        background: var(--accent); color: #000; box-shadow: 0 0 40px var(--accent); transform: scale(1.05);
    }
    .start-btn:disabled { opacity: 0.5; cursor: not-allowed; filter: grayscale(1); }

    /* MOBİL UYUM */
    .mobile-toggle { display: none; }
    
    @media (max-width: 768px) {
        .sidebar { position: fixed; left: -100%; height: 100%; z-index: 500; }
        .sidebar.active { left: 0; box-shadow: 10px 0 30px #000; }
        .mobile-toggle { display: block; position: absolute; top: 20px; left: 20px; background: none; border: none; color: white; font-size: 1.5rem; z-index: 600; }
        
        .gauge-wrapper { transform: scale(0.8); }
        .stats-grid { gap: 20px; }
        .speed-value { font-size: 3rem; }
    }
</style>
</head>
<body>

    <button class="mobile-toggle" onclick="document.querySelector('.sidebar').classList.toggle('active')">
        <i class="fas fa-bars"></i>
    </button>

    <div class="sidebar">
        <div class="logo-area">ODHUN<span>SPEED</span></div>
        <div class="menu-list">
            <div class="menu-item active"><i class="fas fa-tachometer-alt"></i> Hız Testi</div>
        </div>
        <div style="margin-top: auto; padding: 20px; color: #444; font-size: 0.75rem;">
            Odhun.com © 2025
        </div>
    </div>

    <div class="main-content">
        
        <div class="gauge-wrapper">
            <div class="gauge-bg">
                <div class="gauge-fill" id="gaugeFill"></div>
            </div>
            <div class="needle" id="needle"></div>
            
            <div class="speed-text-container">
                <div class="speed-value" id="speedVal">0.0</div>
                <div class="speed-unit">Mbps DOWNLOAD</div>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-box">
                <div class="stat-label"><i class="fas fa-exchange-alt"></i> Ping</div>
                <div class="stat-val" id="pingVal">--</div>
            </div>
            <div class="stat-box">
                <div class="stat-label"><i class="fas fa-globe"></i> IP Adresi</div>
                <div class="stat-val" id="ipVal" style="font-size: 1rem; margin-top: 5px;">...</div>
            </div>
            <div class="stat-box">
                <div class="stat-label"><i class="fas fa-signal"></i> Durum</div>
                <div class="stat-val" id="statusVal" style="font-size: 1rem; margin-top: 5px; color: var(--text-dim);">Hazır</div>
            </div>
        </div>

        <button class="start-btn" onclick="startTest()" id="startBtn">TESTİ BAŞLAT</button>

    </div>

    <script>
        const needle = document.getElementById('needle');
        const speedVal = document.getElementById('speedVal');
        const pingVal = document.getElementById('pingVal');
        const ipVal = document.getElementById('ipVal');
        const statusVal = document.getElementById('statusVal');
        const startBtn = document.getElementById('startBtn');

        // Test Dosyası (Wikimedia CDN - 5MB Yüksek Hız)
        const TEST_FILE = "https://upload.wikimedia.org/wikipedia/commons/2/2d/Snake_River_%285mb%29.jpg";
        const TEST_SIZE = 5242880; // 5 MB in bytes

        window.onload = () => {
            // IP Adresini hemen çek
            fetch('https://api.ipify.org?format=json')
                .then(res => res.json())
                .then(data => { ipVal.innerText = data.ip; })
                .catch(() => { ipVal.innerText = "Gizli"; });
        };

        async function startTest() {
            startBtn.disabled = true;
            startBtn.innerText = "ÖLÇÜLÜYOR...";
            
            // 1. PING TESTİ
            statusVal.innerText = "Ping ölçülüyor...";
            statusVal.style.color = "#ffbd2e"; // Sarı
            const ping = await measurePing();
            pingVal.innerText = Math.round(ping) + " ms";

            // 2. DOWNLOAD TESTİ
            statusVal.innerText = "İndirme hızı...";
            statusVal.style.color = "#00e5ff"; // Mavi
            
            // İbreyi sıfırla
            updateGauge(0);
            
            // İndirmeyi başlat
            const speedMbps = await measureDownload();
            
            // Sonuç
            updateGauge(speedMbps);
            speedVal.innerText = speedMbps.toFixed(1);
            statusVal.innerText = "Tamamlandı";
            statusVal.style.color = "#00ff41"; // Yeşil
            startBtn.disabled = false;
            startBtn.innerText = "TEKRARLA";
        }

        async function measurePing() {
            const start = performance.now();
            try {
                await fetch('https://api.ipify.org?format=json', { cache: "no-store" });
            } catch(e) {}
            const end = performance.now();
            return end - start;
        }

        function measureDownload() {
            return new Promise((resolve) => {
                const startTime = (new Date()).getTime();
                const download = new Image();
                
                // Cache önlemek için random parametre
                download.src = TEST_FILE + "?n=" + Math.random();
                
                // Simüle edilmiş animasyon (Gerçek veri gelene kadar ibre oynasın)
                let simInterval = setInterval(() => {
                    const randomSpeed = Math.random() * 20 + 10; // 10-30 arası oyna
                    updateGauge(randomSpeed);
                    speedVal.innerText = randomSpeed.toFixed(1);
                }, 200);

                download.onload = function () {
                    clearInterval(simInterval);
                    const endTime = (new Date()).getTime();
                    const duration = (endTime - startTime) / 1000; // Saniye
                    
                    // Hız Formülü: (Bits) / (Seconds) / (Megabit Conversion)
                    const bitsLoaded = TEST_SIZE * 8;
                    const speedBps = bitsLoaded / duration;
                    const speedMbps = speedBps / 1024 / 1024;
                    
                    resolve(speedMbps);
                };

                download.onerror = function () {
                    clearInterval(simInterval);
                    statusVal.innerText = "Hata";
                    startBtn.disabled = false;
                    resolve(0);
                };
            });
        }

        function updateGauge(speed) {
            // 0 ile 100 Mbps arası bir skala düşünelim.
            // -90deg (0) ile 90deg (100) arası dönmeli.
            
            let percent = speed;
            if (percent > 100) percent = 100; // Max ibre
            
            // -90 (Sol) -> 90 (Sağ)
            const deg = (percent * 1.8) - 90; 
            
            needle.style.transform = `rotate(${deg}deg)`;
        }

    </script>

</body>
</html>
