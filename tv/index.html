<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Odhun TV | Panel</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        /* Siyah Ekran Sorununu Çözen CSS */
        html, body {
            height: 100%; margin: 0; padding: 0; background-color: #000;
            color: white; font-family: Arial, sans-serif; display: flex; flex-direction: column;
        }

        header {
            background: #222; padding: 10px; display: flex; gap: 10px; align-items: center;
            border-bottom: 2px solid #444; height: 50px; flex-shrink: 0;
        }

        /* Izgara Sistemi */
        #grid-container {
            flex-grow: 1; display: grid; gap: 2px; padding: 2px;
            /* Varsayılan 4x4 */
            grid-template-columns: repeat(4, 1fr); 
            grid-auto-rows: 1fr;
            background: #111;
            overflow: hidden;
        }

        .video-box {
            position: relative; background: #000; border: 1px solid #333;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            overflow: hidden;
        }

        .video-box iframe, .video-box video {
            width: 100%; height: 100%; border: none; object-fit: fill; z-index: 1;
        }

        /* Etiketler */
        .channel-name {
            position: absolute; top: 10px; left: 10px; background: rgba(200, 0, 0, 0.8);
            padding: 3px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; z-index: 5;
            pointer-events: none;
        }

        .error-msg {
            position: absolute; color: red; text-align: center; padding: 20px; z-index: 0;
            font-size: 12px;
        }

        /* Kontroller */
        input { padding: 5px; flex-grow: 1; background: #333; border: 1px solid #555; color: white; }
        button { padding: 5px 10px; cursor: pointer; background: #444; color: white; border: 1px solid #555; }
        button:hover { background: #666; }
        button.active { background: #d32f2f; border-color: red; }

        /* Mobil */
        @media (max-width: 768px) {
            #grid-container { grid-template-columns: 1fr !important; overflow-y: auto; }
            .video-box { min-height: 250px; }
        }

        /* Sistem Logu (Debugging) */
        #debug-log {
            height: 100px; background: #111; border-top: 1px solid #444; 
            font-family: monospace; font-size: 11px; color: #0f0; padding: 5px;
            overflow-y: scroll; display: none; /* İstersen 'block' yapıp hataları gör */
        }
    </style>
</head>
<body>

    <header>
        <h3 style="margin:0;">ODHUN TV</h3>
        <input type="text" id="linkInput" placeholder="YouTube ID veya Link...">
        <button onclick="addNew()"><i class="fas fa-plus"></i></button>
        
        <div style="margin-left:auto;">
            <button onclick="setGrid(1)">1x1</button>
            <button onclick="setGrid(2)">2x2</button>
            <button onclick="setGrid(3)">3x3</button>
            <button onclick="setGrid(4)" class="active">4x4</button>
            <button onclick="window.location.reload()" style="background:#d32f2f;">Yenile</button>
        </div>
    </header>

    <div id="grid-container"></div>
    <div id="debug-log"></div>

    <script>
        const grid = document.getElementById('grid-container');
        const debug = document.getElementById('debug-log');

        function log(msg) {
            console.log(msg);
            debug.innerHTML += `<div>> ${msg}</div>`;
            debug.scrollTop = debug.scrollHeight;
        }

        // SENİN LİSTEN (Hatasız Linkler)
        const channels = [
            { name: "NTV",          src: "XEJaSoPolqA" }, // Güncel ID ile değiştirdim
            { name: "CNN Türk",     src: "6N8_r2uwLEc" },
            { name: "Sözcü TV",     src: "ztmY_cCtUI0" },
            { name: "Habertürk",    src: "RNVNlJSUFoE" },
            { name: "Halk TV",      src: "VBU0QX6brew" },
            { name: "Haber Global", src: "EqoCJ8BPxtE" },
            { name: "EKOL TV",      src: "https://ekoltv-live.elkon.com.tr/hls/ekoltv.m3u8" },
            { name: "TV 100",       src: "6g_DvD8e2T0" },
            { name: "TRT Haber",    src: "https://tv-trthaber.live.trt.net.tr/master.m3u8" },
            { name: "TGRT Haber",   src: "https://tgrt-live.daioncdn.net/tgrthaber/tgrthaber.m3u8" },
            { name: "CNBC-e",       src: "ziYwt0jF1p4" },
            { name: "TYT Türk",     src: "https://cdn-tytturk.yayin.com.tr/tytturk/tytturk/playlist.m3u8" },
            { name: "Ulusal Kanal", src: "dK96AZbCns0" },
            { name: "Bloomberg HT", src: "https://ciner-live.daioncdn.net/bloomberght/bloomberght.m3u8" },
            { name: "TVNET",        src: "https://mn-nl.mncdn.com/tvnet/tvnet.smil/playlist.m3u8" },
            { name: "24 TV",        src: "https://turkmedya-live.daioncdn.net/tv24/tv24.m3u8" }
        ];

        // Başlangıç
        window.onload = function() {
            log("Sistem başlatılıyor...");
            try {
                loadChannels();
            } catch(e) {
                log("KRİTİK HATA: " + e.message);
                alert("Bir hata oluştu: " + e.message);
            }
        };

        function loadChannels() {
            grid.innerHTML = ""; // Temizle
            channels.forEach((ch, index) => {
                createBox(ch);
            });
            log("Kanallar yüklendi.");
        }

        function createBox(ch) {
            const box = document.createElement('div');
            box.className = 'video-box';
            
            // Önce sadece kutuyu ve yazıyı ekle (Video sonra gelecek)
            box.innerHTML = `
                <div class="channel-name">${ch.name}</div>
                <div class="error-msg">Yükleniyor...</div>
                <div style="position:absolute; top:0; right:0; padding:5px; cursor:pointer; z-index:10; background:red;" onclick="this.parentElement.remove()">X</div>
            `;

            grid.appendChild(box);

            // Videoyu oluşturmaya çalış
            setTimeout(() => {
                try {
                    if (ch.src.startsWith('http')) {
                        // HLS Oynatıcı (M3U8)
                        const video = document.createElement('video');
                        video.controls = true;
                        video.autoplay = true;
                        video.muted = true; // Otomatik başlama kuralı
                        video.playsInline = true;

                        box.appendChild(video);

                        if (Hls.isSupported()) {
                            const hls = new Hls();
                            hls.loadSource(ch.src);
                            hls.attachMedia(video);
                            hls.on(Hls.Events.ERROR, (evt, data) => {
                                if(data.fatal) {
                                    log(ch.name + " HLS Hatası: " + data.type);
                                    box.querySelector('.error-msg').innerText = "Yayın Hatası (CORS/Ağ)";
                                }
                            });
                        } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                            video.src = ch.src;
                        } else {
                            box.querySelector('.error-msg').innerText = "Tarayıcı Desteklemiyor";
                        }

                    } else {
                        // YouTube Oynatıcı
                        // ID'nin doğruluğunu kontrol et
                        const ytID = ch.src.length > 5 ? ch.src : "HATA";
                        
                        const iframe = document.createElement('iframe');
                        iframe.src = `https://www.youtube.com/embed/${ytID}?autoplay=1&mute=1&controls=1`;
                        iframe.allow = "autoplay; encrypted-media; picture-in-picture";
                        iframe.allowFullscreen = true;
                        
                        box.appendChild(iframe);
                    }
                } catch (err) {
                    log(ch.name + " Render Hatası: " + err.message);
                }
            }, 100);
        }

        function addNew() {
            const val = document.getElementById('linkInput').value.trim();
            if(!val) return;
            
            // Basit ID tespiti
            let src = val;
            if(val.includes('v=')) src = val.split('v=')[1].split('&')[0];
            else if(val.includes('youtu.be/')) src = val.split('youtu.be/')[1];

            createBox({ name: "Yeni Kanal", src: src });
        }

        function setGrid(n) {
            grid.style.gridTemplateColumns = `repeat(${n}, 1fr)`;
            document.querySelectorAll('button').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
        }
    </script>
</body>
</html>
