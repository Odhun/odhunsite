<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ClashHub | En Ä°yi Desteler & Anlar</title>

<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect width=%22100%22 height=%22100%22 rx=%2210%22 fill=%22%23ff9000%22/><text x=%2250%25%22 y=%2255%25%22 dominant-baseline=%22middle%22 text-anchor=%22middle%22 font-family=%22Arial%22 font-weight=%22900%22 font-size=%2240%22 fill=%22%23000000%22>CH</text></svg>">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">

<style>
    :root {
        --bg: #000000;
        --card-bg: #161616;
        --primary: #ff9000; /* Hub Orange */
        --text: #ffffff;
        --text-dim: #888;
        --border: #2f2f2f;
        --green: #22c55e;
        --red: #ef4444;
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

    body {
        margin: 0; padding: 0; background-color: var(--bg); color: var(--text);
        font-family: 'Inter', Arial, sans-serif; padding-bottom: 50px;
    }

    /* HEADER */
    header {
        background: #000000; padding: 15px 20px; 
        position: sticky; top: 0; z-index: 100;
        border-bottom: 1px solid var(--border);
        display: flex; justify-content: space-between; align-items: center;
    }

    /* LOGO (ClashHub Stili) */
    .brand { 
        font-size: 1.8rem; font-weight: 700; letter-spacing: -1px; 
        display: flex; align-items: center; cursor: pointer;
    }
    .brand-text { color: #fff; margin-right: 3px; }
    .brand-hub { 
        background: var(--primary); color: #000; 
        padding: 3px 6px; border-radius: 4px; 
        font-weight: 900; display: inline-block;
    }
    
    .new-post-btn {
        background: transparent; color: var(--primary); border: 2px solid var(--primary); 
        padding: 6px 15px; border-radius: 4px; font-weight: 700; cursor: pointer; 
        display: flex; align-items: center; gap: 8px; transition: 0.2s; 
        text-transform: uppercase; font-size: 0.85rem;
    }
    .new-post-btn:hover { background: var(--primary); color: #000; }

    /* LAYOUT */
    .main-container {
        max-width: 1200px; margin: 20px auto; padding: 0 15px;
        display: grid; grid-template-columns: 1fr 300px; gap: 25px;
    }

    /* FEED */
    .clash-card {
        background: var(--card-bg); border-radius: 5px; overflow: hidden; margin-bottom: 20px;
        border: 1px solid var(--border); animation: slideUp 0.3s ease;
    }
    @keyframes slideUp { from { opacity:0; transform:translateY(20px); } to { opacity:1; transform:translateY(0); } }

    .card-header {
        padding: 15px; display: flex; align-items: center; gap: 10px; border-bottom: 1px solid var(--border);
    }
    .avatar {
        width: 40px; height: 40px; background: #222; color: var(--primary);
        border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 800;
        border: 1px solid #333;
    }
    .user-info h4 { margin: 0; font-size: 1rem; color: var(--primary); font-weight: 700; }
    .user-info span { font-size: 0.75rem; color: var(--text-dim); }

    .card-body { padding: 15px; }
    .post-text { font-size: 1rem; line-height: 1.5; color: #ddd; white-space: pre-wrap; }
    .post-text a { color: var(--primary); text-decoration: none; font-weight: 700; }
    .post-text a:hover { text-decoration: underline; }
    
    .post-img {
        width: 100%; border-radius: 4px; margin-top: 15px; display: block; 
        max-height: 600px; object-fit: contain; background: #000; border: 1px solid var(--border);
    }

    .card-footer {
        padding: 10px 15px; background: #111; display: flex; justify-content: space-between; align-items: center;
        border-top: 1px solid var(--border);
    }
    .vote-area { display: flex; align-items: center; gap: 15px; }
    
    .vote-btn {
        background: none; border: none; color: var(--text-dim); cursor: pointer; font-size: 1rem;
        display: flex; align-items: center; gap: 5px; transition: 0.2s;
    }
    .vote-btn:hover { color: #fff; }
    .vote-up.active { color: var(--green); }
    .vote-down.active { color: var(--red); }
    
    /* SUPER LIKE BUTONU */
    .super-like-btn {
        background: transparent; border: 1px solid #ff4500; color: #ff4500;
        padding: 5px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: bold; cursor: pointer;
        display: flex; align-items: center; gap: 5px; transition: 0.2s;
    }
    .super-like-btn:hover, .super-like-btn.active {
        background: #ff4500; color: #fff; box-shadow: 0 0 10px rgba(255, 69, 0, 0.4);
    }

    /* SIDEBAR (HASHTAGS) */
    .sidebar-col { position: sticky; top: 90px; height: fit-content; }
    
    .tags-card {
        background: var(--card-bg); border-radius: 5px; padding: 0; border: 1px solid var(--border); overflow: hidden;
    }
    .tags-header { 
        font-weight: 700; font-size: 1rem; padding: 15px; color: var(--text); 
        background: #222; border-bottom: 1px solid var(--border);
        display: flex; align-items: center; gap: 8px;
    }
    .tags-header i { color: var(--primary); }
    
    .tag-list { display: flex; flex-direction: column; }
    .tag-item {
        color: #ccc; text-decoration: none; padding: 10px 15px; 
        border-bottom: 1px solid #222; font-size: 0.9rem; display: flex; justify-content: space-between;
        transition: 0.2s; cursor: pointer;
    }
    .tag-item:hover { background: #222; color: var(--primary); }
    .tag-item span { color: #555; font-size: 0.8rem; }
    .tag-item.active { background: #222; color: var(--primary); border-left: 3px solid var(--primary); }

    .clear-filter { 
        display: none; margin: 15px 0 0 0; width: 100%; padding: 10px; background: #333; border:none; color: #fff; border-radius: 4px; cursor: pointer; font-weight: bold;
    }

    /* MODAL */
    .modal-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.9); z-index: 200; display: none;
        align-items: center; justify-content: center; padding: 20px;
    }
    .modal-content {
        background: var(--card-bg); width: 100%; max-width: 500px; border-radius: 5px;
        padding: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.8); border: 1px solid var(--primary);
    }
    .modal-header { display: flex; justify-content: space-between; margin-bottom: 15px; font-weight: 700; font-size: 1.2rem; color: var(--primary); }
    .close-btn { background: none; border: none; color: #fff; font-size: 1.5rem; cursor: pointer; }
    
    input, textarea {
        width: 100%; background: #000; border: 1px solid #333; color: #fff;
        padding: 12px; border-radius: 4px; margin-bottom: 10px; font-family: inherit; outline: none;
    }
    input:focus, textarea:focus { border-color: var(--primary); }
    textarea { height: 120px; resize: none; }
    
    .media-options { display: flex; gap: 10px; margin-bottom: 15px; }
    .file-label {
        flex: 1; display: flex; align-items: center; justify-content: center; gap: 5px;
        background: #111; padding: 12px; border-radius: 4px; text-align: center;
        cursor: pointer; color: #ccc; border: 1px solid #333; font-size: 0.9rem;
        transition: 0.2s;
    }
    .file-label:hover { border-color: var(--primary); color: var(--primary); background: #000; }
    
    .submit-btn {
        width: 100%; background: var(--primary); color: #000; padding: 12px; border: none;
        border-radius: 4px; font-weight: 800; font-size: 1rem; cursor: pointer; text-transform: uppercase;
    }
    .submit-btn:hover { background: #e68a00; }
    
    #previewImg { width: 100%; max-height: 200px; object-fit: cover; border-radius: 4px; display: none; margin-bottom: 10px; border: 1px solid var(--primary); }
    .loader { text-align: center; padding: 40px; color: var(--primary); font-weight: bold; grid-column: 1 / -1; }

    /* RESPONSIVE */
    @media (max-width: 850px) {
        .main-container { grid-template-columns: 1fr; display: flex; flex-direction: column-reverse; }
        .sidebar-col { position: static; margin-bottom: 20px; }
        .brand { font-size: 1.5rem; }
        .new-post-btn span { display: none; }
    }
</style>
</head>
<body>

    <header>
        <div class="brand" onclick="clearFilter()">
            <span class="brand-text">Clash</span><span class="brand-hub">Hub</span>
        </div>
        <button class="new-post-btn" onclick="openPostModal()">
            <i class="fas fa-plus"></i> <span>YÃ¼kle</span>
        </button>
    </header>

    <div class="main-container">
        
        <div class="feed-col" id="feed">
            <div class="loader">YÃœKLENÄ°YOR...</div>
        </div>

        <aside class="sidebar-col">
            <div class="tags-card">
                <div class="tags-header"><i class="fas fa-fire"></i> Trendler</div>
                <div class="tag-list" id="tagList">
                    </div>
                <button class="clear-filter" id="clearFilterBtn" onclick="clearFilter()">TÃ¼mÃ¼nÃ¼ GÃ¶ster</button>
            </div>
            
            <div style="margin-top: 20px; font-size: 0.7rem; color: #444; text-align: center;">
                Odhun.com Â© 2025<br>ClashHub - Topluluk Platformu
            </div>
        </aside>

    </div>

    <div id="postModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header"><span>Ä°Ã§erik PaylaÅŸ</span><button class="close-btn" onclick="closePostModal()">&times;</button></div>
            <input type="text" id="nickInput" placeholder="KullanÄ±cÄ± AdÄ±" maxlength="20">
            <textarea id="textInput" placeholder="Deste, taktik veya anÄ±nÄ± anlat... Etiket kullanmayÄ± unutma! (Ã–rn: #megaÅŸÃ¶valye #taktik)"></textarea>
            
            <img id="previewImg">
            
            <div class="media-options">
                <label class="file-label">
                    <i class="fas fa-camera"></i> Kamera
                    <input type="file" accept="image/*" capture="environment" style="display:none" onchange="handleFile(this)">
                </label>
                <label class="file-label">
                    <i class="fas fa-image"></i> Galeri
                    <input type="file" accept="image/*" style="display:none" onchange="handleFile(this)">
                </label>
            </div>

            <button class="submit-btn" id="sendBtn" onclick="sendPost()">PAYLAÅž</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, updateDoc, doc, increment, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyB3Cmv9J8x9b53HPzgVmOIEF-_fKhwejPo",
            authDomain: "anit-805a2.firebaseapp.com",
            projectId: "anit-805a2",
            storageBucket: "anit-805a2.firebasestorage.app",
            messagingSenderId: "840387116828",
            appId: "1:840387116828:web:02af9068f7bcdf2135c4d9",
            measurementId: "G-QP5EPSFT8V"
        };

        let db;
        let allPosts = [];
        let activeTag = null;

        try { 
            const app = initializeApp(firebaseConfig); 
            db = getFirestore(app); 
            loadPosts(); 
        } catch (e) { console.log(e); }

        // --- GÃ–NDERÄ° ---
        window.sendPost = async () => {
            const nick = document.getElementById('nickInput').value.trim();
            const text = document.getElementById('textInput').value.trim();
            const img = document.getElementById('previewImg').src;
            const btn = document.getElementById('sendBtn');

            if (!nick || !text) { alert("LÃ¼tfen alanlarÄ± doldurunuz."); return; }

            const hashtags = (text.match(/#[a-z0-9ÄŸÃ¼ÅŸÄ±Ã¶Ã§]+/gi) || []).map(t => t.toLowerCase());

            btn.disabled = true; btn.innerText = "YÃœKLENÄ°YOR...";

            try {
                await addDoc(collection(db, "clash_hub_posts"), {
                    nick: nick, text: text, image: img !== "" && img !== window.location.href ? img : null, 
                    tags: hashtags,
                    likes: 0, dislikes: 0, superLikes: 0, 
                    timestamp: serverTimestamp()
                });
                
                closePostModal();
                document.getElementById('textInput').value = "";
                document.getElementById('previewImg').style.display = 'none';
                document.getElementById('previewImg').src = "";
            } catch (e) { alert("Hata oluÅŸtu."); }
            btn.disabled = false; btn.innerText = "PAYLAÅž";
        };

        // --- YÃœKLEME & RENDER ---
        function loadPosts() {
            const q = query(collection(db, "clash_hub_posts"), orderBy("timestamp", "desc"));
            onSnapshot(q, (snapshot) => {
                allPosts = [];
                snapshot.forEach(doc => {
                    allPosts.push({ id: doc.id, ...doc.data() });
                });
                renderFeed();
                renderTags();
            });
        }

        function renderFeed() {
            const feed = document.getElementById('feed');
            feed.innerHTML = "";
            
            const postsToShow = activeTag 
                ? allPosts.filter(p => p.tags && p.tags.includes(activeTag))
                : allPosts;

            if(postsToShow.length === 0) {
                feed.innerHTML = "<div class='loader' style='color:#666'>HenÃ¼z iÃ§erik yok.</div>";
                return;
            }

            postsToShow.forEach(post => {
                const time = post.timestamp ? new Date(post.timestamp.toDate()).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}) : "Åžimdi";
                const voteState = localStorage.getItem(`ch_vote_${post.id}`); 
                const superState = localStorage.getItem(`ch_super_${post.id}`); 
                
                let imgHtml = post.image && post.image.length > 100 ? `<img src="${post.image}" class="post-img">` : "";
                
                let formattedText = post.text.replace(/(#[a-z0-9ÄŸÃ¼ÅŸÄ±Ã¶Ã§]+)/gi, '<a href="javascript:void(0)" onclick="setFilter(\'$1\')">$1</a>');

                const html = `
                <div class="clash-card">
                    <div class="card-header">
                        <div class="avatar">${post.nick.charAt(0).toUpperCase()}</div>
                        <div class="user-info"><h4>${post.nick}</h4><span>${time}</span></div>
                    </div>
                    <div class="card-body">
                        <div class="post-text">${formattedText}</div>
                        ${imgHtml}
                    </div>
                    <div class="card-footer">
                        <div class="vote-area">
                            <button class="vote-btn vote-up ${voteState==='up'?'active':''}" onclick="vote('${post.id}','up')"><i class="fas fa-thumbs-up"></i> <span>${post.likes||0}</span></button>
                            <button class="vote-btn vote-down ${voteState==='down'?'active':''}" onclick="vote('${post.id}','down')"><i class="fas fa-thumbs-down"></i> <span>${post.dislikes||0}</span></button>
                        </div>
                        <button class="super-like-btn ${superState?'active':''}" onclick="voteSuper('${post.id}')">
                             ðŸ”¥ Ä°yi KoymuÅŸsun (${post.superLikes||0})
                        </button>
                    </div>
                </div>`;
                feed.innerHTML += html;
            });
        }

        function renderTags() {
            const tagCounts = {};
            allPosts.forEach(p => { if(p.tags) p.tags.forEach(t => tagCounts[t] = (tagCounts[t] || 0) + 1); });
            const sortedTags = Object.keys(tagCounts).sort((a,b) => tagCounts[b] - tagCounts[a]);
            
            const list = document.getElementById('tagList');
            list.innerHTML = "";
            
            if(sortedTags.length === 0) list.innerHTML = '<div style="color:#555; font-size:0.8rem; padding:10px;">HenÃ¼z etiket yok.</div>';

            sortedTags.slice(0, 15).forEach(tag => {
                const count = tagCounts[tag];
                const isActive = tag === activeTag ? 'active' : '';
                list.innerHTML += `<div class="tag-item ${isActive}" onclick="setFilter('${tag}')">${tag} <span>${count}</span></div>`;
            });
        }

        window.setFilter = (tag) => {
            activeTag = tag.toLowerCase();
            document.getElementById('clearFilterBtn').style.display = 'block';
            renderFeed(); renderTags(); window.scrollTo(0,0);
        };

        window.clearFilter = () => {
            activeTag = null;
            document.getElementById('clearFilterBtn').style.display = 'none';
            renderFeed(); renderTags();
        };

        // --- OYLAMA SÄ°STEMÄ° ---
        window.vote = async (id, type) => {
            if (localStorage.getItem(`ch_vote_${id}`)) return;
            const postRef = doc(db, "clash_hub_posts", id);
            await updateDoc(postRef, type === 'up' ? { likes: increment(1) } : { dislikes: increment(1) });
            localStorage.setItem(`ch_vote_${id}`, type);
        };

        // --- Ä°YÄ° KOYMUÅžSUN (SESLÄ°) ---
        window.voteSuper = async (id) => {
            if (localStorage.getItem(`ch_super_${id}`)) return;
            
            // SES Ã‡AL
            try {
                const audio = new Audio('hub.mp3');
                audio.play();
            } catch(e) { console.log("Ses hatasÄ±:", e); }

            const postRef = doc(db, "clash_hub_posts", id);
            await updateDoc(postRef, { superLikes: increment(1) });
            localStorage.setItem(`ch_super_${id}`, 'true');
        };

        window.handleFile = (input) => { const f = input.files[0]; if(f) { const r = new FileReader(); r.onload = e => { const i = document.getElementById('previewImg'); i.src = e.target.result; i.style.display = 'block'; }; r.readAsDataURL(f); } }
        window.openPostModal = () => document.getElementById('postModal').style.display = 'flex';
        window.closePostModal = () => document.getElementById('postModal').style.display = 'none';

    </script>

</body>
</html>
