<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Odhun Radio Player</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <style>
    body { background: #0f0f0f; }
    .glass { backdrop-filter: blur(14px) saturate(180%); background-color: rgba(255,255,255,0.1); border-radius: 16px; border: 1px solid rgba(255,255,255,0.2);}  
  </style>
</head>
<body class="text-white select-none">

<!-- MOBILE NAV -->
<div class="fixed bottom-0 left-0 w-full bg-black/40 backdrop-blur-lg p-3 flex justify-around text-xl">
  <button id="navHome">üè†</button>
  <button id="navFav">‚≠ê</button>
  <button id="navSettings">‚öôÔ∏è</button>
</div>

<div id="main" class="max-w-xl mx-auto p-4 pb-32">

  <div class="glass p-6 mt-4">
    <h1 class="text-3xl font-bold mb-4 text-center">Odhun Modern Radyo</h1>

    <!-- SEARCH -->
    <input id="search" type="text" placeholder="Radyo ara..." class="w-full p-3 rounded-xl bg-white/10 mb-4" />

    <!-- CATEGORY FILTER -->
    <div class="flex gap-2 overflow-x-auto pb-2">
      <button data-cat="all" class="catBtn px-4 py-2 bg-white/20 rounded-xl">T√ºm√º</button>
      <button data-cat="pop" class="catBtn px-4 py-2 bg-white/10 rounded-xl">Pop</button>
      <button data-cat="slow" class="catBtn px-4 py-2 bg-white/10 rounded-xl">Slow</button>
      <button data-cat="haber" class="catBtn px-4 py-2 bg-white/10 rounded-xl">Haber</button>
      <button data-cat="yabanci" class="catBtn px-4 py-2 bg-white/10 rounded-xl">Yabancƒ±</button>
    </div>

    <!-- RADIO LIST -->
    <div id="radioList" class="mt-4 max-h-80 overflow-y-auto space-y-3"></div>
  </div>

  <!-- PLAYER -->
  <div class="glass p-6 mt-6 text-center">
    <h2 id="nowPlaying" class="text-xl font-semibold mb-2">Radyo se√ßiniz</h2>
    <button id="playBtn" class="px-6 py-3 bg-white/20 rounded-xl w-full mb-4">‚ñ∂ Oynat</button>

    <!-- VOLUME -->
    <div class="mt-3">
      <input id="volume" type="range" min="0" max="1" step="0.01" value="1" class="w-full" />
    </div>

    <!-- SLEEP TIMER -->
    <div class="mt-4">
      <label>Uyku Zamanlayƒ±cƒ±:</label>
      <select id="sleep" class="bg-white/10 p-2 rounded-xl ml-2">
        <option value="0">Kapalƒ±</option>
        <option value="10">10 dk</option>
        <option value="20">20 dk</option>
        <option value="30">30 dk</option>
        <option value="60">60 dk</option>
      </select>
    </div>

    <!-- VISUALIZER -->
    <canvas id="visualizer" class="w-full h-24 mt-4"></canvas>
  </div>
</div>

<script>
const stations = [
  { name: "PowerT√ºrk", url: "https://powerturk.com.tr/stream.m3u8", cat: "pop" },
  { name: "SlowT√ºrk", url: "https://slowturk.com.tr/stream.m3u8", cat: "slow" },
  { name: "Kral Pop", url: "https://kralpop.com.tr/stream.m3u8", cat: "pop" },
  { name: "CNN T√ºrk Radyo", url: "https://cnnturk.com.tr/stream.m3u8", cat: "haber" }
];

let favorites = JSON.parse(localStorage.getItem("favRadios") || "[]");
let current = null;
let sleepTimer = null;

let audio = document.createElement("audio");
audio.crossOrigin = "anonymous";
let hls;

// HLS SUPPORT
function loadStream(url) {
  if (hls) hls.destroy();
  if (Hls.isSupported()) {
    hls = new Hls();
    hls.loadSource(url);
    hls.attachMedia(audio);
  } else {
    audio.src = url;
  }
  audio.play();
}

// DRAW LIST
const list = document.getElementById("radioList");
function renderList() {
  list.innerHTML = "";
  stations.forEach(st => {
    const el = document.createElement("div");
    el.className = "glass p-3 cursor-pointer flex justify-between items-center hover:bg-white/20";

    el.innerHTML = `
      <span>${st.name}</span>
      <button class="favBtn text-xl">${favorites.includes(st.name) ? "‚≠ê" : "‚òÜ"}</button>
    `;

    el.onclick = e => {
      if (e.target.classList.contains("favBtn")) return;
      selectStation(st);
    };

    el.querySelector(".favBtn").onclick = () => toggleFav(st.name);

    list.appendChild(el);
  });
}
renderList();

function toggleFav(name) {
  if (favorites.includes(name)) favorites = favorites.filter(f => f !== name);
  else favorites.push(name);
  localStorage.setItem("favRadios", JSON.stringify(favorites));
  renderList();
}

// SELECT STATION
function selectStation(st) {
  current = st;
  document.getElementById("nowPlaying").innerText = st.name;
  loadStream(st.url);
  document.getElementById("playBtn").innerText = "‚è∏ Duraklat";
}

// PLAY/PAUSE
playBtn.onclick = () => {
  if (!current) return;
  if (audio.paused) { audio.play(); playBtn.innerText = "‚è∏ Duraklat"; }
  else { audio.pause(); playBtn.innerText = "‚ñ∂ Oynat"; }
};

// VOLUME
volume.oninput = e => { audio.volume = e.target.value; };

// SEARCH
search.oninput = () => {
  const v = search.value.toLowerCase();
  [...list.children].forEach((item, i) => {
    item.style.display = stations[i].name.toLowerCase().includes(v) ? "block" : "none";
  });
};

// CATEGORY
const catBtns = document.querySelectorAll(".catBtn");
catBtns.forEach(btn => btn.onclick = () => {
  catBtns.forEach(b => b.classList.remove("bg-white/20"));
  btn.classList.add("bg-white/20");

  const v = btn.dataset.cat;
  [...list.children].forEach((item, i) => {
    item.style.display = v === "all" || stations[i].cat === v ? "block" : "none";
  });
});

// SLEEP TIMER
sleep.onchange = () => {
  if (sleepTimer) clearTimeout(sleepTimer);
  const mins = parseInt(sleep.value);
  if (mins > 0) sleepTimer = setTimeout(() => audio.pause(), mins * 60000);
};

// VISUALIZER
const canvas = document.getElementById("visualizer");
const ctx = canvas.getContext("2d");
canvas.width = canvas.offsetWidth;
canvas.height = canvas.offsetHeight;
let audioCtx, analyser, src;

audio.onplay = () => {
  if (!audioCtx) {
    audioCtx = new AudioContext();
    analyser = audioCtx.createAnalyser();
    src = audioCtx.createMediaElementSource(audio);
    src.connect(analyser);
    analyser.connect(audioCtx.destination);
  }
  visualize();
};

function visualize() {
  requestAnimationFrame(visualize);
  const data = new Uint8Array(analyser.frequencyBinCount);
  analyser.getByteFrequencyData(data);

  ctx.fillStyle = "black";
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  const barWidth = canvas.width / 64;
  let x = 0;

  for (let i = 0; i < 64; i++) {
    const h = data[i] / 2;
    ctx.fillStyle = "white";
    ctx.fillRect(x, canvas.height - h, barWidth - 2, h);
    x += barWidth;
  }
}
</script>

</body>
</html>
