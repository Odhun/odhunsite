<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Odhun Wheels | Koleksiyon Takip</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='20' fill='%230057b8'/><text x='50' y='55' dominant-baseline='middle' text-anchor='middle' font-family=Arial font-weight='700' font-size='50' fill='%23ffc107'>H</text></svg>">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Russo+One&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<style>
:root{--hw-blue:#0057b8;--hw-orange:#ff6200;--hw-yellow:#ffc107;--bg:#111;--card-bg:#1e1e1e;--text:#fff}
*{box-sizing:border-box}
body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:'Roboto',sans-serif;min-height:100vh;display:flex;flex-direction:column;}
header{background:linear-gradient(135deg,#003060,var(--hw-blue));padding:18px;text-align:center;border-bottom:4px solid var(--hw-orange);position:sticky;top:0;z-index:100}
.brand{font-family:'Russo One',sans-serif;font-size:2rem;color:#fff;text-shadow:2px 2px 0 var(--hw-orange);letter-spacing:1px}
.brand span{color:var(--hw-yellow)}
.controls{padding:16px;max-width:1200px;margin:0 auto;display:flex;flex-direction:column;gap:12px}
.year-tabs{display:flex;background:#222;border-radius:8px;padding:5px;gap:6px;overflow:auto}
.year-tab{padding:8px 14px;border-radius:6px;color:#aaa;font-weight:700;cursor:pointer;white-space:nowrap;text-align:center;flex:0 0 auto}
.year-tab.active{background:var(--hw-blue);color:#fff;box-shadow:0 2px 10px rgba(0,87,184,0.3)}
.control-row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
.search-box{position:relative;flex:1;min-width:220px}
.search-box input{width:100%;padding:10px 38px 10px 12px;border-radius:8px;border:1px solid #333;background:#222;color:#fff;outline:none}
.search-box i{position:absolute;right:12px;top:50%;transform:translateY(-50%);color:#666}
.filter-btn{padding:8px 14px;border-radius:8px;border:1px solid #333;background:#222;color:#aaa;cursor:pointer;font-weight:600}
.filter-btn.active{background:var(--hw-orange);color:#fff;border-color:var(--hw-orange)}
.stats-bar{background:#222;padding:12px;border-radius:12px;margin:10px auto;max-width:1200px;width:95%;display:flex;align-items:center;gap:12px;border:1px solid #333}
.progress-track{flex:1;height:10px;background:#000;border-radius:6px;overflow:hidden}
.progress-fill{height:100%;background:var(--hw-orange);width:0%;transition:0.4s}
.stats-text{font-size:0.9rem;font-weight:700;color:var(--hw-yellow);white-space:nowrap}
.collection-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:14px;padding:0 20px 80px;max-width:1200px;margin:0 auto;width:100%}
.car-card{background:var(--card-bg);border-radius:10px;overflow:hidden;position:relative;cursor:pointer;transition:0.18s;border:2px solid transparent}
.car-card:hover{transform:translateY(-3px);box-shadow:0 6px 18px rgba(0,0,0,0.35)}
.car-card.owned{border-color:var(--hw-blue);background:#0d1b2a}
.car-img-box{width:100%;aspect-ratio:16/9;background:#fff;display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden}
.car-img{width:100%;height:100%;object-fit:contain;transition:0.25s}
.car-card:not(.owned) .car-img{filter:grayscale(100%);opacity:0.65}
.google-search-hint{position:absolute;bottom:6px;right:6px;background:rgba(0,0,0,0.75);color:#fff;text-decoration:none;font-size:0.72rem;padding:4px 8px;border-radius:6px;border:1px solid #444;display:none}
.car-card:hover .google-search-hint{display:block}
.car-details{padding:10px}
.car-num{font-size:0.75rem;font-weight:900;color:var(--hw-orange);display:flex;justify-content:space-between}
.car-title{font-size:0.9rem;font-weight:700;margin:6px 0;line-height:1.2;height:2.6em;overflow:hidden}
.car-series{font-size:0.75rem;color:#888;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.status-badge{font-size:0.7rem;padding:3px 6px;border-radius:6px;background:#333;color:#aaa}
.car-card.owned .status-badge{background:var(--hw-blue);color:#fff}
.footer{padding:18px;text-align:center;color:#888;border-top:1px solid #222;margin-top:auto;background:#0b0b0b}
@media(max-width:600px){.collection-grid{grid-template-columns:repeat(2,1fr);gap:10px;padding:0 10px 80px}.brand{font-size:1.5rem}.google-search-hint{display:block;opacity:0.9}}
</style>
</head>
<body>
<header>
  <div class="brand">ODHUN <span>WHEELS</span></div>
</header>

<div class="controls">
  <div class="year-tabs" role="tablist" aria-label="Yıllar" id="yearTabs"></div>

  <div class="control-row">
    <div class="search-box">
      <input id="searchInput" type="text" placeholder="Model veya Numara Ara..." />
      <i class="fas fa-search"></i>
    </div>
    <div style="display:flex;gap:8px">
      <button class="filter-btn active" data-filter="all">Tümü</button>
      <button class="filter-btn" data-filter="owned">Var</button>
      <button class="filter-btn" data-filter="missing">Yok</button>
    </div>
  </div>
</div>

<div class="stats-bar">
  <div class="progress-track"><div class="progress-fill" id="progressFill"></div></div>
  <div class="stats-text" id="progressText">0 / 250 (%0)</div>
</div>

<div class="collection-grid" id="grid" aria-live="polite"></div>

<div class="footer">Odhun.com © 2025 | Kişisel Koleksiyon Takip Sistemi</div>

<script>
/* Front-end app that loads db_with_images.json and shows the cars.
   Requires hosting via HTTP (python -m http.server) to allow fetch of JSON. */

let db = {}; // loaded from db_with_images.json
let currentYear = null;
let userCollection = [];
let currentFilter = 'all';

function storageKey(year){ return `odhunWheels_collection_${year}`; }

async function loadDB(){
  try {
    const res = await fetch('db_with_images.json', {cache: "no-cache"});
    if(!res.ok) throw new Error('db_with_images.json bulunamadı. Lütfen önce fetch_images.js ile oluşturun ve aynı klasöre koyun.');
    db = await res.json();
    // choose a default year (latest present)
    const years = Object.keys(db).sort().reverse();
    currentYear = years[0] || '2025';
    renderYearTabs(years);
    loadUserCollection();
    renderCars();
    updateProgress();
  } catch(err){
    document.getElementById('grid').innerHTML = `<div style="grid-column:1/-1;text-align:center;padding:20px;color:#f66">Hata: ${escapeHtml(err.message)}</div>`;
    console.error(err);
  }
}

function renderYearTabs(years){
  const container = document.getElementById('yearTabs');
  container.innerHTML = '';
  years.forEach(y=>{
    const el = document.createElement('div');
    el.className = 'year-tab' + (y===currentYear ? ' active' : '');
    el.textContent = y;
    el.tabIndex = 0;
    el.addEventListener('click', ()=>setYear(y, el));
    el.addEventListener('keydown', (e)=> { if(e.key==='Enter') setYear(y, el); });
    container.appendChild(el);
  });
}

function setYear(y, el){
  currentYear = y;
  document.querySelectorAll('.year-tab').forEach(b=>b.classList.toggle('active', b.textContent===y));
  loadUserCollection();
  renderCars();
  updateProgress();
}

function loadUserCollection(){
  userCollection = JSON.parse(localStorage.getItem(storageKey(currentYear)) || "[]");
}

function saveUserCollection(){
  localStorage.setItem(storageKey(currentYear), JSON.stringify(userCollection));
}

function toggleCar(id){
  if(userCollection.includes(id)){
    userCollection = userCollection.filter(x=>x!==id);
  } else {
    userCollection.push(id);
  }
  saveUserCollection();
  renderCars();
  updateProgress();
}

function renderCars(){
  const grid = document.getElementById('grid');
  const q = document.getElementById('searchInput').value.trim().toLowerCase();
  grid.innerHTML = '';
  const cars = db[currentYear] || [];
  const frag = document.createDocumentFragment();

  cars.forEach(car=>{
    const carId = `${currentYear}-${car.n}`;
    const isOwned = userCollection.includes(carId);

    if(q && !car.t.toLowerCase().includes(q) && !car.n.includes(q)) return;
    if(currentFilter==='owned' && !isOwned) return;
    if(currentFilter==='missing' && isOwned) return;

    const card = document.createElement('div');
    card.className = 'car-card' + (isOwned ? ' owned' : '');
    card.setAttribute('role','button');
    card.setAttribute('tabindex','0');
    card.onclick = ()=>toggleCar(carId);
    card.onkeydown = (e)=>{ if(e.key==='Enter' || e.key===' ') toggleCar(carId); };

    const imgUrl = car.i && car.i.trim() ? car.i : `https://via.placeholder.com/400x225/222/fff?text=Görsel+Yok+#${car.n}`;
    const googleSearchUrl = `https://www.google.com/search?tbm=isch&q=Hot+Wheels+${encodeURIComponent(currentYear+' '+car.t+' '+car.n)}`;

    card.innerHTML = `
      <div class="car-img-box">
        <img src="${imgUrl}" alt="${escapeHtml(car.t)}" class="car-img" loading="lazy" onerror="this.src='https://via.placeholder.com/400x225/444/fff?text=Görsel+Yok'">
        <a href="${googleSearchUrl}" target="_blank" class="google-search-hint" onclick="event.stopPropagation();">Görsel Ara <i class="fas fa-search"></i></a>
      </div>
      <div class="car-details">
        <div class="car-num"><span>#${car.n}/250</span><span class="status-badge">${isOwned ? 'VAR' : 'YOK'}</span></div>
        <div class="car-title" title="${escapeHtml(car.t)}">${escapeHtml(car.t)}</div>
        <div class="car-series">${escapeHtml(car.s)}</div>
      </div>
    `;
    frag.appendChild(card);
  });

  grid.appendChild(frag);
  if(!grid.children.length){
    grid.innerHTML = '<div style="grid-column:1/-1;text-align:center;padding:40px;color:#777">Araç bulunamadı.</div>';
  }
}

function updateProgress(){
  const total = 250;
  const ownedCount = userCollection.filter(id => id.startsWith(currentYear)).length;
  const percent = Math.round((ownedCount/total)*100);
  const fill = document.getElementById('progressFill');
  const text = document.getElementById('progressText');
  if(fill) fill.style.width = percent + '%';
  if(text) text.innerText = `${ownedCount} / ${total} (%${percent}) Tamamlandı`;
}

/* UI events */
document.addEventListener('input', (e)=>{
  if(e.target && e.target.id==='searchInput') renderCars();
});
document.addEventListener('click', (e)=>{
  if(e.target && e.target.matches('.filter-btn')){
    document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));
    e.target.classList.add('active');
    currentFilter = e.target.getAttribute('data-filter') || 'all';
    renderCars();
  }
});

/* escape */
function escapeHtml(str){ return String(str||'').replace(/[&<>"']/g, s=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[s]));}

loadDB();
</script>
</body>
</html>
